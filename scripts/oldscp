#!/bin/bash
# oldscp - SCP wrapper with automatic legacy algorithm detection
# Supports macOS systems from 10.5 (Leopard) through current versions
# Automatically detects and uses compatible algorithms based on server capabilities

# SCP command configuration with algorithm fallbacks
# Try newer algorithms first (10.11+), then fall back to older ones (10.5-10.10)
SCP_CMD="/opt/local/bin/scp9"
SCP_OPTS=(
    "-i" "$HOME/.ssh/oldmac"
    "-o" "HostKeyAlgorithms=ssh-rsa"
    "-o" "PubkeyAcceptedKeyTypes=ssh-rsa"
    "-o" "KexAlgorithms=diffie-hellman-group14-sha1,ecdh-sha2-nistp256,diffie-hellman-group1-sha1"
    "-o" "Ciphers=aes128-ctr,aes128-cbc"
    "-o" "MACs=hmac-sha1"
    "-o" "StrictHostKeyChecking=no"
    "-o" "Protocol=2"
)

# Execute SCP with algorithm detection
# SCP client will automatically select the first working combination
$SCP_CMD "${SCP_OPTS[@]}" "$@"

