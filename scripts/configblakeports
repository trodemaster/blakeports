#!/bin/bash
set -euo pipefail

SOURCES_CONF="/opt/local/etc/macports/sources.conf"
BLAKEPORTS_DIR="/Users/admin/code/blakeports"

# Check if blakeports is already configured as default
if grep -q "file://${BLAKEPORTS_DIR} \[default\]" "$SOURCES_CONF" 2>/dev/null; then
    echo "blakeports already configured as default source"
else
    echo "Configuring blakeports as default MacPorts source..."
    sudo tee "$SOURCES_CONF" <<EOF
file:///Users/admin/code/blakeports [default]
https://mirror.fcix.net/macports/release/tarballs/ports.tar
EOF
    echo "MacPorts sources.conf updated successfully"
    echo "blakeports directory set as default source"
    sudo port sync
fi

